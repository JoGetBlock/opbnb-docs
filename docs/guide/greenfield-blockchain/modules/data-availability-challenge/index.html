<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/greenfield-blockchain/modules/data-availability-challenge">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Data Availability Challenge | BNB Optimistic Rollup</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Availability Challenge | BNB Optimistic Rollup"><meta data-rh="true" name="description" content="Data availability refers to the correct storage and accessibility of data on storage providers for users."><meta data-rh="true" property="og:description" content="Data availability refers to the correct storage and accessibility of data on storage providers for users."><link data-rh="true" rel="icon" href="/opbnb-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/opbnb-docs/blog/rss.xml" title="BNB Optimistic Rollup RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/opbnb-docs/blog/atom.xml" title="BNB Optimistic Rollup Atom Feed"><link rel="stylesheet" href="/opbnb-docs/assets/css/styles.cbba8081.css">
<link rel="preload" href="/opbnb-docs/assets/js/runtime~main.caf89853.js" as="script">
<link rel="preload" href="/opbnb-docs/assets/js/main.29781c01.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/opbnb-docs/"><div class="navbar__logo"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--light_HNdA"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Optimistic Rollup</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>Data Availability Challenge</h1><p>Data availability refers to the correct storage and accessibility of data on storage providers for users.
To determine if a specific data segment or piece is correctly stored on a designated storage provider,
a challenge module is employed. The challenge comprises three steps:</p><ol><li>The validator requests the data piece and local manifest of the object from the challenged storage provider.
If the expected piece is not obtained, it is considered unavailable.</li><li>The validator computes the hash of the local manifest and compares it with the global manifest recorded in the
object&#x27;s metadata. If they differ, the piece is considered unavailable.</li><li>The validator computes the hash of the challenged data piece and compares it with the data recorded in the local
manifest. If they differ, the piece is considered unavailable.</li></ol><p>The validator collects challenge signatures and if more than two-thirds of validators vote the same result,
those signatures are aggregated to create a data challenge attestation. This attestation is then submitted on-chain
via a transaction that awards the first submitter. Subsequent submissions of the same attestation will fail verification.
Only the validators whose votes were included in the attestation are rewarded, therefore, some validators who voted but
were not included will not be rewarded for the data availability challenge.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">​</a></h2><p><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-whitepaper/main/assets/19.2%20Data%20Availability%20Challenge.jpg" alt="Data Availability Challenge Workflow" class="img_ev3q"></p><div style="text-align:center"><i>Data Availability Challenge Workflow</i></div><p>The Workflow for the Data Availability Challenge is as Follows:</p><ol><li>Any user can submit a transaction to challenge the availability of data. The related information will be recorded
temporarily on-chain and also be included in typed events once the transaction is executed.</li><li>At the end block phase of each block, a random algorithm is used to generate data availability challenge events by
default. All challenge information will be stored until confirmed or expired.</li><li>The off-chain data availability detection module tracks on-chain challenge information and initiates off-chain detection.</li><li>The validator uses their BLS private key to sign a data challenge vote that includes block header, data challenge information, and the result.</li><li>The validator collates data challenge votes, aggregates the signatures, and creates a data challenge attestation.</li><li>Once 2/3 validators have reached an agreement, the validator submits the attestation.</li><li>The data challenge attestation transaction is executed, and the attestation is verified, and the challenge storage is cleared.
Malicious nodes are penalized, and rewards are distributed. A cooling-off period is implemented to avoid repeated attacks.</li><li>During the cooling-off period, the validator can regain, recover, or shift the data.
Once the cooling-off period expires, the data can be challenged again. If the data is still unavailable, the validator will be penalized once more.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-challenge">Create Challenge<a class="hash-link" href="#create-challenge" title="Direct link to heading">​</a></h2><p>There are two ways to trigger challenges.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="submitted-challenges">Submitted Challenges<a class="hash-link" href="#submitted-challenges" title="Direct link to heading">​</a></h3><p>Anyone can send <code>MsgSubmit</code> messages to trigger data availability challenges, if he/she finds that the data is not
available or incorrect stored. When submitting the challenge, user can choose the segment/piece of an object to
challenge or let the blockchain randomly selects a segment/piece to challenge.
The submitter will be called as challenger, and will be rewarded if the challenge
succeeds later.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="random-challenges">Random Challenges<a class="hash-link" href="#random-challenges" title="Direct link to heading">​</a></h3><p>In each block, challenges will be automatically created, to challenge different objects which are stored on different
storage providers. The count of random challenges in each block is governed, and can be changed by submitting proposals.
To support randomness, a <em>RANDAO</em> mechanism is introduced in Greenfield blockchain. For more information about <em>RANDAO</em>,
please refer to the following section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="attest-challenge">Attest Challenge<a class="hash-link" href="#attest-challenge" title="Direct link to heading">​</a></h2><p>Each validator will listen to the events of challenge creations, and vote the challenge by using its own BLS key.
When there are more than 2/3 votes are collected, an attestation message <code>MsgAttest</code> will be submitted to slash the
challenged storage provider. And the voted validators, the attestation submitter, and the challenger (if there is) will
be rewarded accordingly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenge-heartbeat">Challenge Heartbeat<a class="hash-link" href="#challenge-heartbeat" title="Direct link to heading">​</a></h2><p>To indicate the off-chain challenge detect module is running correctly, validators have to vote and submit
<code>MsgHeartbeat</code> messages periodically to the blockchain. During processing this kind of messages, the income for securing
stored objects will be transferred from payment account to distribution account,
and income can be withdrawn by validators and their delegators later.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenge-events">Challenge Events<a class="hash-link" href="#challenge-events" title="Direct link to heading">​</a></h2><p>The following events are introduced for data availability challenge. For the detailed definition, please refer
to <a href="https://github.com/bnb-chain/greenfield/blob/master/proto/greenfield/challenge/events.proto" target="_blank" rel="noopener noreferrer">this</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-event">Start Event<a class="hash-link" href="#start-event" title="Direct link to heading">​</a></h3><p>This kind of events indicates that a data availability challenge is triggered on-chain. The off-chain module should
monitor the events, asking the according storage prover for data, compute hashes and do the comparison, and submit
an attestation if needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-event">Complete Event<a class="hash-link" href="#complete-event" title="Direct link to heading">​</a></h3><p>When an attestation is received and accepted, then this kind of events will be emitted. In the events, the slash
and rewards amounts are also recorded.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="heartbeat-event">Heartbeat Event<a class="hash-link" href="#heartbeat-event" title="Direct link to heading">​</a></h3><p>Heartbeat only includes the necessary information for liveness-check purpose. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="randao">RANDAO<a class="hash-link" href="#randao" title="Direct link to heading">​</a></h2><p>To support random challenges, a RANDAO mechanism is introduced like the following.
Overall, the idea is very similar to the RANDAO in Ethereum beacon chain, you can refer to
<a href="https://eth2book.info/altair/part2/building_blocks/randomness" target="_blank" rel="noopener noreferrer">here</a> for more information.</p><p>When proposing a new block, the proposer, i.e. a validator, needs to sign the current block number to get
a <code>randao reveal</code>, and mixes the reveal into randao result <code>randao mix</code> by using <code>xor</code> operation.
The other validators will verify the <code>randao reveal</code> and <code>randao mix</code> by following steps: </p><ol><li>The signature is verified using the proposer&#x27;s public key. It means that the proposer has almost no choice
about what it contributes to the RANDAO. It either contributes the correct signature over the block number,
or it gives up the right for proposing the current block. If the validator does propose the current block,
it still cannot predict the reveal from other validators, and even be slashed for stopping proposing blocks.</li><li>The <code>randao mix</code> is correctly updated by using <code>xor</code> operation.</li></ol><p>The implementation is conducted in Tendermint layer - a new field called <code>randao_mix</code> is added into block header.
Greenfield blockchain then uses the field as a seed to randomly pick objects and storage providers to challenge
in each block.</p></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/opbnb-docs/docs/guide/greenfield-blockchain/modules/data-availability-challenge.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li><li><a href="#create-challenge" class="table-of-contents__link toc-highlight">Create Challenge</a><ul><li><a href="#submitted-challenges" class="table-of-contents__link toc-highlight">Submitted Challenges</a></li><li><a href="#random-challenges" class="table-of-contents__link toc-highlight">Random Challenges</a></li></ul></li><li><a href="#attest-challenge" class="table-of-contents__link toc-highlight">Attest Challenge</a></li><li><a href="#challenge-heartbeat" class="table-of-contents__link toc-highlight">Challenge Heartbeat</a></li><li><a href="#challenge-events" class="table-of-contents__link toc-highlight">Challenge Events</a><ul><li><a href="#start-event" class="table-of-contents__link toc-highlight">Start Event</a></li><li><a href="#complete-event" class="table-of-contents__link toc-highlight">Complete Event</a></li><li><a href="#heartbeat-event" class="table-of-contents__link toc-highlight">Heartbeat Event</a></li></ul></li><li><a href="#randao" class="table-of-contents__link toc-highlight">RANDAO</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/opbnb-docs/assets/js/runtime~main.caf89853.js"></script>
<script src="/opbnb-docs/assets/js/main.29781c01.js"></script>
</body>
</html>