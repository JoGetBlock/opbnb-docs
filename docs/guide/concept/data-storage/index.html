<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/concept/data-storage">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Data Storage | BNB Optimistic Rollup</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/concept/data-storage"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Storage | BNB Optimistic Rollup"><meta data-rh="true" name="description" content="An object on the Greenfield is stored among multi-SPs like below, for example, 50MB:"><meta data-rh="true" property="og:description" content="An object on the Greenfield is stored among multi-SPs like below, for example, 50MB:"><link data-rh="true" rel="icon" href="/opbnb-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/concept/data-storage"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/concept/data-storage" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/concept/data-storage" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/opbnb-docs/blog/rss.xml" title="BNB Optimistic Rollup RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/opbnb-docs/blog/atom.xml" title="BNB Optimistic Rollup Atom Feed"><link rel="stylesheet" href="/opbnb-docs/assets/css/styles.cbba8081.css">
<link rel="preload" href="/opbnb-docs/assets/js/runtime~main.caf89853.js" as="script">
<link rel="preload" href="/opbnb-docs/assets/js/main.29781c01.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/opbnb-docs/"><div class="navbar__logo"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--light_HNdA"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Optimistic Rollup</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Storage</h1></header><div class="row"><div class="col col--12"><p>An object on the Greenfield is stored among multi-SPs like below, for example, 50MB:</p><p><img loading="lazy" alt="EC.png" src="/opbnb-docs/assets/images/10-SP-EC-a6d9a06707fe1498ae2406b1cf065e73.jpg" width="1300" height="614" class="img_ev3q"></p><p>We will introduce some concepts about data storage before describing in detail.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="segment">Segment<a class="hash-link" href="#segment" title="Direct link to heading">​</a></h2><p>Segment is the basic storage unit of an object. An object payload is composed of one
or many segments in sequence. The segment size is globally configured on the Greenfield
blockchain. The default segment size is 16MB.  For larger objects, the payload data will
be broken into many segments. If the object&#x27;s size is less than 16MB, it has only one
segment and the segment size is the same as the object&#x27;s size.</p><p>Please note the payload data of an object will be split into the same size segment
but the last segment, which is the actual size. For example, if one object has a size
50MB, only the size of the last segment is 2 MB and the other segments&#x27; sizes are all 16MB.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ec-chunk">EC Chunk<a class="hash-link" href="#ec-chunk" title="Direct link to heading">​</a></h2><p>Erasure Code (EC) is introduced to get efficient data redundancy on Greenfield. Segment
is the boundary to perform erasure encoding. Some EC chunks are generated by erasure
encoding one segment at a time. EC strategy is globally configured on the Greenfield block
chain. The default EC strategy is 4+2, 4 data chunks, and 2 parity chunks for one segment.
The data chunk size is ¼ of the segment. As one typical segment is 16M, one typical data chunk
of EC is 4M.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="piece">Piece<a class="hash-link" href="#piece" title="Direct link to heading">​</a></h2><p>Piece is the basic storage unit for backend storage on Greenfield. Each segment or EC chunk
can be regarded as one data piece. And the key for each piece is generated based on the
policy on the Greenfield chain.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="primary-sp">Primary SP<a class="hash-link" href="#primary-sp" title="Direct link to heading">​</a></h2><p>Each bucket on the Greenfield is bound with one SP, which is called primary SP. And the user
needs to select an SP as the primary SP when creating a bucket. For all the objects stored
under the bucket, primary SP will store one complete copy, all segments of the objects’
payload data. And only the primary SP serves users’ read or download requests.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="secondary-sp">Secondary SP<a class="hash-link" href="#secondary-sp" title="Direct link to heading">​</a></h2><p>EC chunks of an object payload data are stored on some SPs, which are called secondary SPs.
Each secondary SP stores part of payload data, which is used for better data availability.
The object payload can be recovered from EC chunks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="redundancy-strategy">Redundancy Strategy<a class="hash-link" href="#redundancy-strategy" title="Direct link to heading">​</a></h2><p>Redundancy strategy defines how an object payload is stored among SPs, which is globally
configured on the Greenfield blockchain. Below is the current strategy:</p><ul><li>The data stream of the file will be split into segments according to the granularity of the segment size.
If the size of the data is less than the segment size, it will be split according to the size of the data itself.
The default segment size is 16MB;</li><li>Greenfield uses Reed-Solomon algorithm <a href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction" target="_blank" rel="noopener noreferrer">Reed-Solomon</a>
as its EC strategy, the default data blocks are 4, and the default parity blocks are 2 .</li><li>All the segment pieces of an object are stored on the Primary SP;</li><li>After EC encoding with the segment, the EC encoding module will generate six EC chunk pieces.
All the EC chunk pieces of the segment will be stored to the six chosen secondary SPs.</li></ul><p>For example, when processing a 32MB file, the object is split into two segments. These two segments are stored in the primary storage provider, and each segment is encoded using erasure coding to generate six 4MB pieces. These six pieces are stored in six secondary storage providers in numerical order.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integrity-hash">Integrity Hash<a class="hash-link" href="#integrity-hash" title="Direct link to heading">​</a></h2><p>The integrity hashes include a root hash of the primary SP and several root hashes for each secondary SP which
based on the EC strategy. The number of secondary hashes is equal dataBlocks plus parityBlock
(it is six for now). Each piece&#x27;s hash is computed
by using hash algorithm (default is sha256) on the data piece&#x27;s content. The pieces&#x27; root hash is computed based
on all the pieces&#x27; hashes.</p><p>The calculation process can be represented as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// secondaryHashN represents the Integrity Hash calculated by the Nth secondary SP.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// segmentN_pieceN represents the Nth piece of the Nth segment of the object after EC encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IntegrityHashes = [primaryHash, secondaryHash1 ...secondaryHash6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primaryHash := hash(hash(segment1)+hash(segment2)..+hash(segmentN))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondaryHashN := hash(hash(segment1_pieceN)+hash(segment2_pieceN)..+hash(segmentN_pieceN))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For example, when processing a 32MB file, we got two segments called segment1 and segment2.
The integrity hash of the primary SP is equal with hash(hash(segment1) + hash(segment2)).
For each secondary SP, it stored piece1 and piece2  which is the encoding  result by the segments.
The integrity hash of the first secondary SP is equal with hash(hash(segment1_piece1) + hash(segment2_piece1)).</p><p>Integrity hash is an important metadata of objects on the chain. During the process of creating an object, the integrity hash of each object is calculated and this information is recorded on the blockchain to ensure the accuracy of the data.</p></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/opbnb-docs/docs/guide/concept/data-storage.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#segment" class="table-of-contents__link toc-highlight">Segment</a></li><li><a href="#ec-chunk" class="table-of-contents__link toc-highlight">EC Chunk</a></li><li><a href="#piece" class="table-of-contents__link toc-highlight">Piece</a></li><li><a href="#primary-sp" class="table-of-contents__link toc-highlight">Primary SP</a></li><li><a href="#secondary-sp" class="table-of-contents__link toc-highlight">Secondary SP</a></li><li><a href="#redundancy-strategy" class="table-of-contents__link toc-highlight">Redundancy Strategy</a></li><li><a href="#integrity-hash" class="table-of-contents__link toc-highlight">Integrity Hash</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/opbnb-docs/assets/js/runtime~main.caf89853.js"></script>
<script src="/opbnb-docs/assets/js/main.29781c01.js"></script>
</body>
</html>